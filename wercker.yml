box: sawatani/Cordova
build:
    steps:
        - script:
            name: install-dartlang
            code: |-
                sudo apt-get update -y
                sudo apt-get install apt-transport-https
                sudo sh -c 'curl https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add -'
                sudo sh -c 'curl https://storage.googleapis.com/download.dartlang.org/linux/debian/dart_stable.list > /etc/apt/sources.list.d/dart_stable.list'
                sudo apt-get update -y
                sudo apt-get install -y dart
        - script:
            name: pre-build
            code: |-
                (cd dart && /usr/lib/dart/bin/pub build)
                sudo npm install
                sudo npm install -g ionic
                ./reinstall_plugins.sh
        - script:
            name: keystore
            code: |-
                echo "$ANDROID_KEYSTORE_BASE64" | base64 -d > platforms/android/keystore
                echo 'key.store=keystore'                                   > platforms/android/ant.properties
                echo "key.alias=$ANDROID_KEYSTORE_ALIAS"                   >> platforms/android/ant.properties
                echo "key.store.password=$ANDROID_KEYSTORE_PASSWORD"       >> platforms/android/ant.properties
                echo "key.alias.password=$ANDROID_KEYSTORE_ALIAS_PASSWORD" >> platforms/android/ant.properties
        - script:
            name: build
            code: |-
                cordova build android --release
                cp -vf platforms/android/ant-build/CordovaApp-release.apk "$WERCKER_OUTPUT_DIR"/
deploy:
    steps:
        - sawatani/Android-GooglePlay:
            track_name: $TRACK_NAME
            application_name: TritonNote
            package_name: org.fathens.triton_note
            service_account_email: $ACCOUNT_EMAIL
            service_account_key_base64: $ACCOUNT_KEY
            apk_file_path: CordovaApp-release.apk
